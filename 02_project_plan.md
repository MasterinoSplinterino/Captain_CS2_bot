# План реализации: CS2 Server + Telegram Bot Control

Этот документ описывает пошаговый план развертывания локального сервера Counter-Strike 2 и создания Telegram-бота для управления им, согласно техническому заданию.

## 1. Подготовка окружения

**Цель:** Подготовить сервер (локальный ПК) для запуска контейнеризированных приложений.

*   [ ] **Установка Docker Desktop** (для Windows) или Docker Engine (для Linux).
*   [ ] **Проверка ресурсов:** Убедиться, что свободно минимум 40-50 ГБ места на диске (CS2 занимает много места) и достаточно ОЗУ (минимум 4-6 ГБ для сервера).
*   [ ] **Получение токенов:**
    *   `STEAM_GAME_SERVER_LOGIN_TOKEN` (GSLT) через Steam Game Server Account Management.
    *   `TELEGRAM_BOT_TOKEN` через @BotFather.
    *   Узнать свой `TELEGRAM_USER_ID` через @userinfobot.

## 2. Развертывание CS2 Сервера (Docker)

**Цель:** Запустить базовый сервер CS2, к которому можно подключиться из игры и по RCON.

*   [ ] **Создание структуры проекта:**
    ```text
    cs2-project/
    ├── bot/                # Исходный код бота
    ├── cs2-data/           # Данные сервера (карты, конфиги)
    └── docker-compose.yml  # Основной файл запуска
    ```
*   [ ] **Настройка `docker-compose.yml`:**
    *   Использование образа `kus/cs2-modded-server` (или официального, если modded не требуется).
    *   Проброс портов: `27015/udp` (Game), `27015/tcp` (RCON).
    *   Настройка переменных окружения: `RCON_PASSWORD`, `CS2_PASSWORD`, `CS2_SERVERNAME`, `CS2_GSLT_TOKEN`.
*   [ ] **Первичный запуск:** Проверка, что сервер скачивается, запускается и доступен в локальной сети.
*   [ ] **Тест RCON:** Подключение к серверу через RCON-консоль (в игре или сторонней утилитой) для проверки пароля.

## 3. Разработка Telegram Ботa

**Цель:** Создать интерфейс управления сервером.

*   [ ] **Технологический стек:** Python 3.11+, `aiogram` (или `python-telegram-bot`), `python-valve` (для RCON).
*   [ ] **Структура бота:**
    *   `config.py`: Чтение переменных окружения.
    *   `rcon_client.py`: Класс-обертка для отправки команд на сервер.
    *   `handlers.py`: Обработчики команд `/start`, `/map`, `/mode`, `/kick` и т.д.
    *   `keyboards.py`: Инлайн-клавиатуры для выбора карт и режимов.
*   [ ] **Реализация функций:**
    *   **Security:** Middleware для проверки ID пользователя.
    *   **Map Change:** Список карт -> RCON `changelevel`.
    *   **Game Mode:** Список режимов -> RCON `game_type`, `game_mode`.
    *   **Player Management:** RCON `status` -> Парсинг ответа -> Вывод списка -> RCON `kick`.
*   [ ] **Dockerization:** Создание `Dockerfile` для бота.

## 4. Интеграция и Cloudflare Tunnel

**Цель:** Объединить сервисы и дать доступ извне.

*   [ ] **Обновление `docker-compose.yml`:** Добавление сервиса `bot` в ту же сеть, что и `cs2-server`.
*   [ ] **Настройка Cloudflare Tunnel:**
    *   Установка `cloudflared` (можно также в Docker).
    *   Настройка туннеля для проброса UDP/TCP трафика (требует настройки на стороне клиента Cloudflare WARP для игроков, либо использование Spectrum, если доступно, но для домашнего сервера проще просто пробросить порты на роутере, если есть "белый" IP. Если "белого" IP нет — Tunnel отличное решение, но требует настройки клиента у игроков).
    *   *Альтернатива:* ZeroTier или Tailscale для игры с друзьями.
*   [ ] **Финальное тестирование:**
    *   Запуск всего стека одной командой.
    *   Проверка управления через бота с мобильного телефона.
    *   Подключение к игре.

## 5. План действий (Checklist)

1.  Создать папку проекта.
2.  Написать `docker-compose.yml` для CS2.
3.  Запустить и дождаться скачивания сервера.
4.  Написать код бота (Python).
5.  Добавить бота в `docker-compose.yml`.
6.  Запустить всё вместе и протестировать.
