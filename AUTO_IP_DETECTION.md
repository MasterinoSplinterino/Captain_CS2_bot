# üåê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ IP

## ‚ú® –ß—Ç–æ –Ω–æ–≤–æ–≥–æ
- –î–æ–±–∞–≤–ª–µ–Ω sidecar-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `public-ip`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–π IP –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ –æ–±—â–∏–π —Ç–æ–º.
- –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ–ª—å—à–µ –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –∏ –Ω–µ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ `Cannot retrieve your public IP address`.
- Telegram‚Äë–±–æ—Ç —á–∏—Ç–∞–µ—Ç —Ç–æ—Ç –∂–µ –∫—ç—à –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å—Ç–∞—Ç—É—Å–µ.

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. **`public-ip`** (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `ip-detector/`)
   - –ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ `alpine`. –°–∫—Ä–∏–ø—Ç `public_ip_detector.sh` –∫–∞–∂–¥—ã–µ `PUBLIC_IP_REFRESH_SECONDS` —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–±—É–µ—Ç `dig` –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ HTTPS‚Äë—Å–µ—Ä–≤–∏—Å–æ–≤.
   - –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∏—à–µ—Ç—Å—è –≤ `/shared/public_ip.txt` –∏ `/shared/public_ip.json` (–æ–±—â–∏–π –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–º `public-ip-cache`).
2. **`scripts/public_ip_entrypoint.sh`**
   - –ò—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `cs2` –ø–µ—Ä–µ–¥ `install_docker.sh`.
   - –ñ–¥—ë—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (–¥–æ `PUBLIC_IP_WAIT_SECONDS`), —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `PUBLIC_IP`, –≤–µ—à–∞–µ—Ç shim –¥–ª—è `dig`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞.
   - –ï—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∑–∞–ø—É—Å–∫.
3. **`bot`**
   - –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç `/shared` –≤ —Ä–µ–∂–∏–º–µ read-only –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `read_public_ip_from_cache()` / `get_preferred_connect_address()` –∏–∑ `bot_config.py`.
   - –í —Å—Ç–∞—Ç—É—Å–µ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç IP –∏–∑ –∫—ç—à–∞, –∑–∞—Ç–µ–º –¥–æ–º–µ–Ω / —Ä—É—á–Ω–æ–π IP –∏–∑ `.env`, –∏ —Ç–æ–ª—å–∫–æ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ HTTP‚Äë—Å–µ—Ä–≤–∏—Å–∞–º –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
–í `.env` –æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–º–∏:
```env
CS2_IP=
CS2_DOMAIN=
```
`public-ip` –∑–∞–ø–æ–ª–Ω–∏—Ç –∫—ç—à, `cs2` –∏ `bot` –ø–æ–¥—Ö–≤–∞—Ç—è—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º
```env
CS2_IP=123.45.67.89:27015
CS2_DOMAIN=cs2.example.com:27015
```
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `CS2_DOMAIN` ‚Üí `CS2_IP` ‚Üí –∫—ç—à (`/shared/public_ip.txt`) ‚Üí HTTP‚Äëfallback —É –±–æ—Ç–∞.

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
| –§–∞–π–ª / –°–µ—Ä–≤–∏—Å | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------------|-----------|
| `docker-compose*.yml` | –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `public-ip`, –æ–±—â–∏–π —Ç–æ–º `public-ip-cache`, –ø—Ä–æ–±—Ä–æ—à–µ–Ω `/shared` –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `PUBLIC_IP_FILE`. |
| `ip-detector/Dockerfile` + `public_ip_detector.sh` | –ù–æ–≤—ã–π –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –∫—Ä—É—Ç–∏—Ç—Å—è –≤ —Ñ–æ–Ω–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à (txt + json). |
| `scripts/public_ip_entrypoint.sh` | –ü–µ—Ä–µ—à—ë–ª –Ω–∞ —á—Ç–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞, –¥–æ–±–∞–≤–∏–ª –æ–∂–∏–¥–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π shim `dig` –≤ `/tmp/public-ip-tools`. |
| `bot/bot_config.py` | –ü–æ—è–≤–∏–ª–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–∏ `read_public_ip_from_cache()`, `get_cached_ip_endpoint()`, `get_preferred_connect_address()`. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç `/shared/public_ip.txt`. |
| `bot/handlers.py` | –°—Ç–∞—Ç—É—Å –∏ Quick Connect –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–µ —Ö–µ–ª–ø–µ—Ä—ã; –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–¥—Ä–µ—Å–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω. |

–û–±—â–∏–π —Ç–æ–º –æ–±—ä—è–≤–ª–µ–Ω —Ç–∞–∫:
```yaml
volumes:
  public-ip-cache:
```
–∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `/shared` (rw –≤ `public-ip`, ro –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö).

---

## üìä –ü—Ä–∏–º–µ—Ä—ã
### –°–≤–µ–∂–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ VPS
```bash
git clone <repo>
cd cs2
cp .env.example .env
# CS2_IP –∏ CS2_DOMAIN –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º–∏
docker compose -f docker-compose.prod.yml up -d public-ip cs2 bot
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º –∂—É—Ä–Ω–∞–ª—ã:
```bash
docker logs cs2-public-ip | tail -n5
[public-ip-detector][INFO] Detected public IP: 79.137.206.223
```
–ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª `/shared/public_ip.txt` –∑–∞–ø–æ–ª–Ω–µ–Ω, `cs2` –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ—à–∏–±–∫—É, –∞ –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç IP –≤ —Å—Ç–∞—Ç—É—Å–µ.

### –ü–µ—Ä–µ–µ–∑–¥ –Ω–∞ –Ω–æ–≤—É—é VPS
1. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ `/opt/cs2-data`.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ `public-ip`: `docker compose up -d public-ip`.
3. –ü–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ `cs2` –∏ `bot` ‚Äî —Å–µ—Ä–≤–µ—Ä –Ω–µ —É–ø–∞–¥—ë—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä –µ—â—ë –Ω–µ —É—Å–ø–µ–ª –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å (–±—É–¥–µ—Ç –ª–∏—à—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ).

### Playit.gg / –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç—É–Ω–Ω–µ–ª—å –∏–ª–∏ –¥–æ–º–µ–Ω, –ø—Ä–æ–ø–∏—à–∏—Ç–µ –µ–≥–æ –≤ `.env`. –ö—ç—à –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è, –Ω–æ `bot` –∏ `cs2` –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à –¥–æ–º–µ–Ω / IP —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º.

---

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫
| –°–∏–º–ø—Ç–æ–º | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|----------|---------|
| `cs2` —Å–Ω–æ–≤–∞ –ø–∏—à–µ—Ç `Cannot retrieve your public IP address` | `docker logs cs2-public-ip` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ `dig`/`curl`? | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `cs2-public-ip` –∑–∞–ø—É—â–µ–Ω –∏ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç/DNS. |
| –í —Å—Ç–∞—Ç—É—Å–µ –Ω–µ—Ç IP | `docker exec -it cs2-bot ls /shared`? —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç? | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–º `public-ip-cache` —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `bot` –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `PUBLIC_IP_FILE` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `/shared/public_ip.txt`. |
| –ù—É–∂–µ–Ω —Å—Ç–∞—Ç–∏—á–Ω—ã–π IP | –ó–∞–¥–∞–π—Ç–µ `CS2_IP` –∏–ª–∏ `CS2_DOMAIN`, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `bot`. –ö—ç—à –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤. |

–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫—ç—à–∞
docker exec -it cs2-public-ip cat /shared/public_ip.txt
# –§–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
docker restart cs2-public-ip
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –±–æ—Ç–∞ –∫ —Ñ–∞–π–ª—É
docker exec -it cs2-bot cat /shared/public_ip.txt
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- **–ò–∑–æ–ª—è—Ü–∏—è** ‚Äî —Å–±–æ–π –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫** ‚Äî IP –¥–æ—Å—Ç—É–ø–µ–Ω –±–æ—Ç–∞–º, —Å–∫—Ä–∏–ø—Ç–∞–º –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É —á–µ—Ä–µ–∑ –æ–±—â–∏–π —Ç–æ–º.
- **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, send-to-Discord) –ø—Ä–æ—Å—Ç–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–≤ `public-ip-cache`.

---

## üöÄ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
1. `docker ps` ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `cs2-public-ip`, `cs2-server`, `cs2-bot` —Ä–∞–±–æ—Ç–∞—é—Ç.
2. `docker logs cs2-public-ip` ‚Äî –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å `Detected public IP`.
3. `docker logs cs2-server` ‚Äî –Ω–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ `Cannot retrieve your public IP address`.
4. –í Telegram `/start ‚Üí Status` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è IP/–¥–æ–º–µ–Ω –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `connect`.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ `cs2-public-ip` –∏ `cs2-bot` (`docker logs -f ...`).
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ DNS/HTTPS –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `public-ip` (–∫–æ–º–∞–Ω–¥—ã `dig`, `curl`).
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–¥–∞–π—Ç–µ IP –≤—Ä—É—á–Ω—É—é –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ issue —Å –ª–æ–≥–∞–º–∏ –≤—Å–µ—Ö —Ç—Ä—ë—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
